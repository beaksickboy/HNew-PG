import 'package:flutter_test/flutter_test.dart';
import 'package:http/http.dart' as http;
import 'package:hacker_new/src/shared/models/article.dart';

import 'dart:convert';

void main() {
  test("Parse top stories json", () {
    const data =
        """[ 20485038, 20485014, 20485508, 20484904, 20477000, 20483970, 20477945, 20484444, 20476355, 20484479, 20482768, 20481171, 20460659, 20482902, 20473133, 20484100, 20483681, 20470128, 20481512, 20484197, 20484858, 20483783, 20484398, 20482895, 20483902, 20484597, 20483325, 20481223, 20476837, 20483161, 20477074, 20480261, 20484594, 20480669, 20472179, 20479680, 20477740, 20477670, 20485216, 20485006, 20484995, 20477873, 20475865, 20481987, 20484958, 20479015, 20482291, 20484589, 20484540, 20478498, 20480827, 20478785, 20480995, 20478860, 20484558, 20477949, 20472061, 20468845, 20481551, 20484330, 20480398, 20484979, 20477212, 20477104, 20474530, 20481026, 20479471, 20478339, 20480723, 20481225, 20477895, 20483591, 20483685, 20477793, 20475942, 20477881, 20477979, 20473464, 20479872, 20483584, 20468057, 20463170, 20476045, 20479157, 20473205, 20478372, 20467611, 20480277, 20474878, 20461514, 20470439, 20473522, 20476439, 20459783, 20476991, 20481494, 20477259, 20478425, 20475258, 20475111, 20479426, 20482424, 20475737, 20477958, 20476286, 20483700, 20467140, 20470350, 20476524, 20477265, 20478133, 20479366, 20468164, 20458660, 20476919, 20475957, 20474494, 20472021, 20484461, 20466641, 20479162, 20465430, 20462349, 20468964, 20476678, 20484624, 20457706, 20473819, 20468870, 20472351, 20478470, 20474486, 20478141, 20476977, 20465817, 20466196, 20470519, 20474103, 20470404, 20467917, 20469218, 20468008, 20471129, 20478156, 20468716, 20470604, 20471577, 20482601, 20458493, 20479683, 20482050, 20480412, 20470479, 20475516, 20473860, 20464408, 20468224, 20480323, 20468768, 20479475, 20464645, 20477174, 20464496, 20466986, 20466542, 20477714, 20465756, 20469017, 20468986, 20473542, 20472640, 20475030, 20470783, 20480837, 20464852, 20472088, 20479517, 20473416, 20468767, 20484252, 20466761, 20484231, 20465361, 20477801, 20474551, 20468696, 20464602, 20474724, 20484172, 20477498, 20465348, 20472786, 20466488, 20463494, 20470335, 20464215, 20481186, 20472225, 20473336, 20464418, 20460438, 20461925, 20483637, 20464841, 20481925, 20466536, 20472942, 20463381, 20475067, 20459755, 20482396, 20468148, 20483955, 20480886, 20483894, 20464441, 20465184, 20472817, 20478401, 20463251, 20461952, 20462504, 20480329, 20476363, 20480715, 20464486, 20475619, 20483689, 20476780, 20477181, 20468756, 20463163, 20483642, 20458275, 20465696, 20460509, 20464695, 20465718, 20481982, 20461169, 20466970, 20471511, 20468395, 20465814, 20460660, 20483157, 20483499, 20484732, 20473494, 20461577, 20475896, 20460325, 20459116, 20460596, 20481449, 20462544, 20460283, 20458772, 20479684, 20479670, 20473073, 20467253, 20475229, 20474947, 20463321, 20466083, 20471651, 20469141, 20470991, 20466221, 20459195, 20460855, 20458173, 20460237, 20470303, 20480194, 20484282, 20471679, 20469343, 20467588, 20460943, 20458112, 20478571, 20476164, 20464894, 20461668, 20476857, 20462486, 20463315, 20475839, 20478871, 20459978, 20483434, 20467929, 20460494, 20471935, 20462629, 20479681, 20467125, 20473505, 20473399, 20477114, 20475154, 20475166, 20475073, 20472917, 20460522, 20472663, 20475940, 20464651, 20466385, 20477563, 20476565, 20468332, 20465716, 20472008, 20462415, 20468040, 20458478, 20463911, 20478426, 20459981, 20473538, 20465552, 20475792, 20462907, 20467058, 20474184, 20469470, 20462250, 20473736, 20473614, 20476323, 20471421, 20458542, 20469043, 20465635, 20465524, 20469968, 20464986, 20465265, 20464777, 20469965, 20471429, 20464624, 20477847, 20475774, 20471428, 20463074, 20470724, 20462678, 20478259, 20474093, 20470188, 20477630, 20470127, 20473657, 20463204, 20460397, 20462667, 20477045, 20468589, 20467342, 20470940, 20476095, 20458159, 20465339, 20461153, 20473277, 20475734, 20472854, 20459982, 20475549, 20472789, 20471724, 20468291, 20461812, 20467963, 20466364, 20470298, 20463931, 20463314, 20468629, 20466545, 20460673, 20459075, 20472592, 20459229, 20472269, 20462623, 20472108, 20471957, 20466441, 20465262, 20477485, 20461395, 20464957, 20470947, 20464652, 20467189, 20479223, 20467067, 20470337, 20470297, 20463974, 20466548, 20469616, 20466202, 20473325, 20468859, 20465837, 20460926, 20465503, 20468311, 20466312, 20460634, 20464763, 20458709, 20458657, 20464167, 20467811, 20463319, 20462925, 20458725, 20458603, 20461815, 20465988, 20458327, 20465419, 20464959, 20464783, 20464757, 20463893, 20463209, 20474647, 20462980, 20462725, 20462295, 20461957, 20473306, 20460709, 20459028, 20477210, 20459446, 20458861, 20458842, 20458512, 20474142, 20458404, 20463046, 20477233, 20457994, 20484852, 20462348, 20472198, 20466549, 20476304, 20468755, 20463467, 20467376, 20458616, 20470274, 20461175, 20466730, 20467117, 20484306, 20482374, 20460559, 20458363, 20473702, 20481829, 20480847, 20478631, 20460101, 20466469, 20459501, 20469194, 20464248 ]""";
    expect(parseTopStories(data).first, 20485038);
  });

  test("Parse item", () async {
    final url = 'https://hacker-news.firebaseio.com/v0/topstories.json';
    final res = await http.get(url);
    if (res.statusCode == 200) {
      final idList = jsonDecode(res.body);
      final storyRes = await http.get('https://hacker-news.firebaseio.com/v0/item${idList.first}.json');
      if (storyRes.statusCode == 200) {
        expect(parseArticle(storyRes.body).by, isNotNull);
      }
    }

  }, skip: true);
}
